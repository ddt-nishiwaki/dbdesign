サーバーCPUの机上サイジング

システム変更(つまりシステムのリプレース)プロジェクトにいて、サイジングを担当することになりました。
話を単純にするために、単純なハードウェアリプレースのみで、
アプリケーションには改修がはいらず、現行通りと仮定しましょう。
変更されるのは、サーバーやストレージなどハードウェアのみです。
また、現行システムのアクセスログやリソースログは取得することができるため、レスポンスとスループットは算出できます。

しかしプロジェクトマネージャからは、次のように言われています。
「このシステム、今はお客さんからピーク時間帯になると遅いと苦情が来るんだ。
今度はこんなことがないよう、適切なハードウェアを選んでくれよ」

プロジェクトの予算は少ないため、プロトタイプ検証を行う余裕はありません。
さて皆さんはどんな手順でサーバーのCPUについて机上サイジングを実施すればいいでしょうか？
なるべく具体的に、手順を考えてください。


回答：

まず「ピーク時間帯になると遅いと苦情が来る」からアクセスが集中した時のパフォーマンスに問題があると推測できます。
なのでパフォーマンスの改善を考えます。「変更されるのは、サーバーやストレージなどハードウェアのみ」、「プロジェクトの予算は少ない」という条件から低コストで行える施策でサイジングを実施することを考えます。また今回は「プロトタイプ検証を行う余裕はありません」ので類似の稼働中システムのデータを流用する方法で基礎数値を得ます。

性能要件として「処理時間」と「スループット」が考えられますが、「ピーク時間帯になると遅い」ことからスループットについて考えていきます。
スループットは「１秒あたりの仕事量」をTPSという指標で表します。要件定義の段階で決まっているTPSとピーク時間帯に計測したTPSを比較してみて要件定義の基準を満たしていないならここを改善することを考えます。

次にピーク時間帯におけるハードウェアの使用率を確認します。CPUやメモリに負荷がかかっているのであれば,要件定義を満たす性能のものを選定する必要があります。ここに問題がないとするとストレージI/Oの性能を疑うべきです。実際にDB性能問題の多くはディスクI/Oによって起きるため、ここをvmstatなどのコマンドで確認していきます。通常時とピーク時の情報を比較し読み書きに使用した時間が極端に異なるようであればディスクI/Oの改善を検討します。

ディスクI/Oの改善で考えられることとしては、性能の高いストレージを選定すること、またはRAID,クラスタの導入の検討を考えます。今回のケースでは予算が少ないためRAID5の検討が現実的だと考えられます。

